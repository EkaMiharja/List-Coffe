<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Kafe</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="list.css">

    <link rel="icon" type="image/png" href="favicon-32x32.png">
</head>
<body>
    <!-- Loader -->
<div id="loader" class="loader">
    <svg class="pl" width="240" height="240" viewBox="0 0 240 240">
        <circle class="pl__ring pl__ring--a" cx="120" cy="120" r="105" fill="none" stroke-width="20"
        stroke-dasharray="0 660" stroke-dashoffset="-330" stroke-linecap="round"></circle>
        <circle class="pl__ring pl__ring--b" cx="120" cy="120" r="35" fill="none" stroke-width="20"
        stroke-dasharray="0 220" stroke-dashoffset="-110" stroke-linecap="round"></circle>
        <circle class="pl__ring pl__ring--c" cx="85" cy="120" r="70" fill="none" stroke-width="20"
        stroke-dasharray="0 440" stroke-linecap="round"></circle>
        <circle class="pl__ring pl__ring--d" cx="155" cy="120" r="70" fill="none" stroke-width="20"
        stroke-dasharray="0 440" stroke-linecap="round"></circle>
    </svg>
</div>
    <!-- End Loader -->

<!-- Wave Background -->
<div>
    <div class="wave"></div>
    <div class="wave"></div>
    <div class="wave"></div>
</div>
<!--Wave Background End-->

    <!-- Navbar Bootstrap -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow">
        <div class="container-fluid">
            <a class="navbar-brand fw-semibold" href="#">
                <i class="fa-solid fa-mug-hot me-2"></i> Coffee List
            </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" id="navToggle">
            <span class="navbar-toggler-icon"></span>
        </button>

            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="list.html">Daftar Kafe</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Tambah Data</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End Navbar -->

    <div class="container">
        <h1>Daftar Kafe</h1>

        <!-- Filter Kategori -->
        <div class="mb-3 text-center">
            <label for="filterKategori" class="form-label fw-semibold">Filter Kategori:</label>
            <select id="filterKategori" class="form-select w-auto d-inline-block">
                <option value="">Semua Kategori</option>
            </select>
        </div>

        <div class="table-wrapper">
            <table id="dataTable" class="table table-borderless align-middle">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Kafe</th>
                        <th>Lokasi</th>
                        <th>Link</th>
                        <th>Kategori</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4">Memuat data...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    const sheetURL = 'https://script.google.com/macros/s/AKfycbyjUDDgpP5n7YnNKRhwax4FJMThCUt6-XbIWKqhvJZbVNfQtEHoTmF9OStnPVKxWYCOkg/exec';
    const tableBody = document.querySelector('#dataTable tbody');
    const filterSelect = document.getElementById('filterKategori');
    let allData = [];

    async function loadData() {
        try {
            const res = await fetch(sheetURL);
            const data = await res.json();
            allData = data;
            populateFilterOptions(data);
            renderTable(data);
        } catch (error) {
            tableBody.innerHTML = `<tr><td colspan="4">Gagal memuat data: ${error.message}</td></tr>`;
        }
    }

    function populateFilterOptions(data) {
        const categories = [...new Set(data.map(row => row.kategori).filter(Boolean))];
        categories.forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat;
            opt.textContent = cat;
            filterSelect.appendChild(opt);
        });
    }

    function renderTable(data) {
        if (!data || data.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="4">Tidak ada data</td></tr>`;
            return;
        }

        const rows = data.map((row, index) => `
            <tr data-index="${index}">
                <td>${index + 1}</td>
                <td>${row.kafe || '-'}</td>
                <td>${row.lokasi || '-'}</td>
                <td><a href="${row.link}" target="_blank">Link</a></td>
                <td>${row.kategori || '-'}</td>
                <td>
                    <button class="btn btn-danger btn-sm delete-btn">Hapus</button>
                </td>
            </tr>
        `).join('');
        tableBody.innerHTML = rows;

        // Event listener tombol delete
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
            const rowEl = e.target.closest('tr');
            const index = parseInt(rowEl.getAttribute('data-index'));

            if (isNaN(index)) return; // safety: jangan hapus kalau index tidak valid

            if (!confirm("Apakah yakin ingin menghapus data ini?")) return;

            try {
                const res = await fetch(sheetURL, {
                    method: 'POST',
                    body: new URLSearchParams({
                        action: 'delete',
                        index: index
                    })
                });

                const result = await res.json();
                if (result.result === "success") {
                    allData.splice(index, 1);
                    renderTable(allData);
                } else {
                    alert("Gagal menghapus: " + result.error);
                }
            } catch (err) {
                alert("Error: " + err.message);
            }
        });
    });
}


    filterSelect.addEventListener('change', () => {
        const selected = filterSelect.value;
        if (!selected) {
            renderTable(allData);
        } else {
            const filtered = allData.filter(item => item.kategori === selected);
            renderTable(filtered);
        }
    });

    loadData();

    // Tambahkan efek dorong ke bawah saat hamburger diklik
    const navToggle = document.getElementById('navToggle');
    const navbar = document.getElementById('navbarNav');

    navbar.addEventListener('shown.bs.collapse', () => {
        document.body.classList.add('nav-open');
    });

    navbar.addEventListener('hidden.bs.collapse', () => {
        document.body.classList.remove('nav-open');
    });
    </script>
    <script>
    const loader = document.getElementById('loader');

    window.addEventListener('load', () => {
        // Delay sedikit biar animasinya sempat kelihatan
        setTimeout(() => {
        loader.classList.add('hidden');
        }, 1200);
    });

    window.addEventListener("scroll", function () {
        const navbar = document.querySelector(".navbar");
        if (window.scrollY > 50) {
            navbar.classList.add("scrolled");
        } else {
        navbar.classList.remove("scrolled");
        }
    });
</script>
</body>
</html>
